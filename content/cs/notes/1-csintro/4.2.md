---
title: 4.2 C程序设计基础
---

本节主要针对已熟悉 C 语言语法的读者，总结考试中容易混淆或需要记忆的细节，如运算符优先级、格式化占位符、指针运算规则等。

## 1. 运算符优先级 (Operator Precedence)

C 语言的优先级非常多，以下是**从高到低**的排列。**易错点已加粗**。

| 优先级 | 运算符                                              | 结合性     | 描述/示例                                                      |
| :----- | :-------------------------------------------------- | :--------- | :------------------------------------------------------------- |
| 1      | `()` `[]` `->` `.`                                  | 左到右     | 函数调用、数组下标、结构体成员                                 |
| 2      | `!` `~` `++` `--` `+` `-` `*` `&` `(type)` `sizeof` | **右到左** | **单目运算符**。`*p++` 等价于 `*(p++)` (先取值，后指针自增)    |
| 3      | `*` `/` `%`                                         | 左到右     | 乘除模。`5/2` 结果为 `2` (整数除法截断)                        |
| 4      | `+` `-`                                             | 左到右     | 加减                                                           |
| 5      | `<<` `>>`                                           | 左到右     | 移位                                                           |
| 6      | `<` `<=` `>` `>=`                                   | 左到右     | 关系运算                                                       |
| 7      | `==` `!=`                                           | 左到右     | **等于/不等于**。注意 `if(a=b)` 是赋值表达式，恒为真(除非 b=0) |
| 8      | `&`                                                 | 左到右     | 按位与                                                         |
| 9      | `^`                                                 | 左到右     | 按位异或                                                       |
| 10     | `\|`                                                | 左到右     | 按位或                                                         |
| 11     | `&&`                                                | 左到右     | **逻辑与**。短路特性。优先级**低于**按位与 `&`                 |
| 12     | `\|\|`                                              | 左到右     | **逻辑或**。短路特性。                                         |
| 13     | `?:`                                                | **右到左** | 三目运算符                                                     |
| 14     | `=` `+=` `-=` `*=` ...                              | **右到左** | 赋值                                                           |
| 15     | `,`                                                 | 左到右     | 逗号运算符 (取最后一个表达式的值)                              |

{{< callout >}}

**经典陷阱**：

- `*p++`：先使用 `p` 指向的值，然后 `p` 指针自增。
- `(*p)++`：先使用 `p` 指向的值，然后该**值**自增。
- `a & b == c`：等价于 `a & (b == c)` (因为 `==` 高于 `&`)。通常意图是 `(a & b) == c`。

{{</ callout >}}

## 2. 数据类型与大小 (Data Types)

具体大小依赖于编译器和平台 (ILP32 vs LP64)，但以下关系恒成立：`sizeof(char) <= sizeof(short) <= sizeof(int) <= sizeof(long) <= sizeof(long long)`。

| 类型        | 常见大小 (32/64 位)        | 格式化符 (printf) | 格式化符 (scanf) | 范围 (有符号)           |
| :---------- | :------------------------- | :---------------- | :--------------- | :---------------------- |
| `char`      | 1 byte                     | `%c`              | `%c`             | -128 ~ 127              |
| `short`     | 2 bytes                    | `%hd`             | `%hd`            | -32768 ~ 32767          |
| `int`       | 4 bytes                    | `%d` / `%i`       | `%d`             | ±21 亿 (approx)         |
| `long`      | 4 bytes (Win), 8 (Linux64) | `%ld`             | `%ld`            |                         |
| `long long` | 8 bytes                    | `%lld`            | `%lld`           | ±9e18                   |
| `float`     | 4 bytes                    | `%f`              | **`%f`**         | 精度约 6-7 位           |
| `double`    | 8 bytes                    | `%f` 或 `%lf`     | **`%lf`**        | 精度约 15-16 位         |
| `void *`    | 4 or 8 bytes               | `%p`              | `%p`             | 指针地址                |
| `size_t`    | 4 or 8 bytes               | `%zu`             | `%zu`            | 无符号，sizeof 的返回值 |

{{< callout >}}

**注意**：

- `scanf` 读取 `double` **必须**用 `%lf`，而 `printf` 输出 `double` 可以用 `%f` (因为 float 会自动提升为 double)。
- `unsigned` 类型使用 `%u`。
- `0` 开头是八进制 (`010` = 8)，`0x` 开头是十六进制。

{{</ callout >}}

## 3. 格式化输入输出 (printf/scanf)

### printf 修饰符

语法：`%[flags][width][.precision]specifier`

- **Width (宽度)**: `%5d` (至少 5 位，右对齐，左补空格)。
- **Flags (标志)**:
  - `-`: 左对齐 (`%-5d` -> `"12   "`).
  - `0`: 补零 (`%05d` -> `"00012"`).
  - `+`: 显示正负号 (`%+d` -> `+12`).
- **Precision (精度)**:
  - 对于 float/double: `%.2f` (保留 2 位小数，四舍五入).
  - 对于 string: `%.5s` (最多输出 5 个字符).

### scanf 细节

- **地址参数**: 除了字符串数组名本身就是地址外，其他变量必须加 `&`。
  - `scanf("%d", &n);` (正确)
  - `scanf("%s", str);` (正确，str 是数组名)
- **空白符处理**:
  - `%d`, `%f`, `%s` 会**自动跳过**前导空白符 (空格、换行、Tab)。
  - `%c` **不会**跳过空白符。如果缓冲区里有换行符，`%c` 会读取它。
  - **解决**: `scanf(" %c", &ch);` (在 %c 前加空格，强制跳过空白)。
- **字符串**: `%s` 读到空格或换行符停止。读取含空格的行需用 `fgets`。

## 4. 指针与数组 (Pointers & Arrays)

- **数组名**: `arr` 相当于 `&arr[0]` (常量指针)。
- **指针运算**:
  - `ptr + 1`: 内存地址增加 `sizeof(type)` 个字节。
  - `ptr1 - ptr2`: 返回两个指针之间的**元素个数** (不是字节数)。
- **字符串**:
  - C 字符串以 `\0` (ASCII 0) 结尾。
  - `char s[] = "abc";` 大小为 4 (包含 `\0`)。
  - `strlen(s)` 返回 3 (不包含 `\0`)。
  - `sizeof(s)` 返回 4。

## 5. 预处理与存储类

- **宏定义**: `#define SQUARE(x) ((x)*(x))` (务必加括号，防止 `SQUARE(1+2)` 变成 `1+2*1+2`)。
- **static**:
  - 修饰局部变量：延长生命周期至程序结束，只初始化一次。
  - 修饰全局变量/函数：限制作用域在**当前文件**内 (Internal Linkage)。
- **extern**: 声明变量或函数在其他文件中定义。
