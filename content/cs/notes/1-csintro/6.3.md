---
title: 6.3 硬件中断与异常
---

在计算机系统中，CPU 不能一直只埋头执行当前的程序。它需要能够响应外部设备的请求（如键盘输入）或处理程序运行中的错误（如除以零）。这种打断 CPU 正常执行流程的机制统称为**中断 (Interrupts)**。

中断机制使得 CPU 可以从“轮询 (Polling)”这种低效的等待模式中解脱出来，实现高效的并发处理。

## I/O 的硬件中断

这是最典型的中断类型，通常由 CPU 外部的输入输出设备产生。

- **定义**：由外部设备（如键盘、鼠标、网卡、硬盘）发出的信号，告诉 CPU 有事情发生了。
- **特点**：**异步 (Asynchronous)**。这些中断随时可能发生，与 CPU 当前正在执行的指令无关。
- **常见场景**：
  - **键盘输入**：当你按下一个键，键盘控制器发送中断，CPU 暂停当前工作去读取按键字符。
  - **磁盘读写完成**：程序请求读取文件，磁盘准备好数据后发送中断通知 CPU。
  - **网络数据包到达**：网卡接收到新数据时通知 CPU。
- **处理流程**：
  1. 设备发送中断信号。
  2. CPU 完成当前指令后，暂停执行当前程序。
  3. 保存当前程序的上下文（PC、寄存器等）。
  4. 跳转到对应的**中断处理程序 (ISR)**。
  5. 处理完毕后，恢复上下文，继续执行原程序。

## CPU 的硬件中断

这类中断通常由 CPU 内部的硬件模块产生，用于维持系统的正常运行或响应硬件级别的特殊事件。

- **定义**：源自 CPU 内部硬件组件的中断信号。
- **核心示例：时钟中断 (Timer Interrupt)**
  - **作用**：这是现代操作系统实现**多任务 (Multitasking)** 的基础。
  - **机制**：CPU 内部有一个定时器，每隔固定的时间（如 10ms）产生一次中断。
  - **意义**：它强制 CPU 暂停当前进程，将控制权交给操作系统调度器。这样，操作系统可以决定是否切换到另一个进程，防止某个程序独占 CPU（无限循环）。
- **其他示例**：
  - **硬件故障**：如电源故障检测、温度过高报警等。

## “异常”中断

这一类通常被称为**异常 (Exceptions)** 或**同步中断**，它们是程序执行过程中“自发”产生的。

- **定义**：由 CPU 执行当前指令的结果所触发的事件。
- **特点**：**同步 (Synchronous)**。如果程序再次运行到同一条指令，并且环境相同，异常会在完全相同的时间点发生。
- **主要类型**：
  1. **故障 (Faults)**：
     - **除零异常**：程序试图执行 `x / 0`。
     - **缺页异常 (Page Fault)**：程序访问的内存页面不在物理内存中。操作系统会捕获这个异常，从磁盘加载页面，然后**重新执行**那条指令。
  2. **陷阱 (Traps) / 软中断**：
     - **系统调用 (System Call)**：程序故意触发的异常（如 `syscall` 指令）。这是用户程序向操作系统请求服务（如打开文件、打印文字）的唯一合法途径。
  3. **终止 (Aborts)**：
     - 严重的硬件错误或非法操作（如非法指令码），导致程序无法继续运行，只能被操作系统强制结束。

### 总结对比

| 类型             | 来源         | 异步/同步 | 示例                   |
| :--------------- | :----------- | :-------- | :--------------------- |
| **I/O 硬件中断** | 外部设备     | 异步      | 键盘输入、网络包到达   |
| **CPU 硬件中断** | CPU 内部组件 | 异步      | 时钟中断               |
| **“异常”中断**   | 指令执行     | 同步      | 除以零、系统调用、缺页 |
