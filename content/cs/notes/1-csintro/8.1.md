---
title: 8.1 无远弗届的网络
---

计算机网络通过分层模型（通常采用 TCP/IP 五层模型）来组织复杂的通信过程。每一层都建立在下一层的基础之上，为上一层提供服务。

## 物理层（Physical Layer）

物理层是网络的最底层，负责在物理媒介上传输原始的**比特流 (Bits)**。

- **功能**：定义物理设备的电气、机械、功能和过程特性（如电压高低代表 1 或 0，接口形状等）。
- **传输介质**：
  - **有线**：双绞线（网线）、光纤（利用光全反射传输，速度快损耗低）、同轴电缆。
  - **无线**：无线电波（Wi-Fi）、微波、红外线。
- **设备**：中继器 (Repeater)、集线器 (Hub)。
- **单位**：比特 (Bit)。

### 信道复用技术 (Multiplexing)

为了提高通信线路的利用率，通常需要在同一条传输介质上同时传输多路信号，这就是**信道复用**。

- **频分复用 (FDM, Frequency Division Multiplexing)**：
  - 将频谱分为若干个互不重叠的频带，每路信号占用一个频带。
  - **类比**：收音机不同电台使用不同频率，互不干扰。
- **时分复用 (TDM, Time Division Multiplexing)**：
  - 将时间划分为一段段等长的时隙，每路信号轮流占用时隙进行传输。
  - **类比**：大家轮流发言，每人讲一分钟。
- **波分复用 (WDM, Wavelength Division Multiplexing)**：
  - 光的频分复用。在光纤中传输不同波长（颜色）的光信号。
  - **特点**：极大提高了光纤的传输容量。
- **码分复用 (CDM, Code Division Multiplexing)**：
  - 主要用于无线通信（如 3G/4G）。
  - 每个用户分配一个唯一的码序列（码片），各用户使用同样的频率同时发送数据，通过解码分离出特定用户的信号。

### 电路交换与分组交换 (Circuit vs. Packet Switching)

数据在网络核心中传输主要有两种交换方式：

1. **电路交换 (Circuit Switching)**

   - **核心思想**：在通信双方之间建立一条**专用**的物理通路。
   - **特点**：
     - **独占资源**：通话期间，链路带宽（频率或时隙）被固定分配给用户，其他用户无法使用。
     - **三个阶段**：建立连接 $\to$ 数据传输 $\to$ 释放连接。
   - **优缺点**：实时性好，延迟低且固定；但线路利用率低（静默期也占用资源），抗毁性差。
   - **典型案例**：传统公共电话交换网 (PSTN)。

2. **分组交换 (Packet Switching)**
   - **核心思想**：将数据划分为较小的**分组 (Packets)** 进行传输。
   - **机制**：**存储转发 (Store-and-Forward)**。路由器收到一个分组，先暂时存储，检查无误并查找路由表后，再转发给下一个链路。
   - **特点**：
     - **统计复用**：用户按需占用链路，多路数据动态共享带宽。
     - **无连接**：通常不需要预先分配固定资源。
   - **优缺点**：线路利用率高，适应突发流量；但存在排队延迟 (Queuing Delay)，可能发生丢包 (Packet Loss)。
   - **典型案例**：互联网 (Internet)。

## 数据链路层（Data Link Layer）

数据链路层负责在**相邻**的两个节点（Node-to-Node）之间传输数据，将比特流组装成**帧 (Frame)**。

- **功能**：
  - **物理寻址**：使用 **MAC 地址**（媒体访问控制地址）来标识网络设备。MAC 地址是全球唯一的（如 `00:1A:2B:3C:4D:5E`）。
  - **差错检测**：检测传输过程中是否发生比特翻转（如 CRC 循环冗余校验）。
  - **介质访问控制**：决定谁可以在什么时候发送数据（如以太网的 CSMA/CD 机制）。
- **协议**：以太网 (Ethernet)、Wi-Fi (802.11)。
- **设备**：交换机 (Switch)、网卡 (NIC)。
- **单位**：帧 (Frame)。

## 网络层（Network Layer）

网络层负责将数据从源主机传输到目标主机（Host-to-Host），可能跨越多个不同的网络。它的核心任务是**路由 (Routing)** 和 **逻辑寻址**。

- **单位**：数据包 (Packet)。
- **设备**：路由器 (Router)。

### 互联网协议版本 4 (IPv4) 详解

IP (Internet Protocol) 是网络层的核心协议。IPv4 是目前使用最广泛的版本。

#### IPv4 地址结构

- **长度**：32 位（4 字节）。
- **表示**：点分十进制 (Dotted Decimal)，如 `192.168.1.1`。
- **组成**：分为**网络号**（标识网络）和**主机号**（标识该网络内的特定设备）。子网掩码 (Subnet Mask) 用于区分这两部分。

#### IPv4 地址类型

IPv4 地址根据用途和范围可以分为以下几类：

- **分类编址 (Classful Addressing)**（历史方案，但概念仍常用）：

  - **A 类**：`0.0.0.0` - `127.255.255.255`。网络号占 8 位（首位为 0），主机号占 24 位。适用于超大型网络。
  - **B 类**：`128.0.0.0` - `191.255.255.255`。网络号占 16 位（前两位 10），主机号占 16 位。适用于中型网络。
  - **C 类**：`192.0.0.0` - `223.255.255.255`。网络号占 24 位（前三位 110），主机号占 8 位。适用于小型网络。
  - **D 类**：`224.0.0.0` - `239.255.255.255`。用于**多播 (Multicast)**。
  - **E 类**：`240.0.0.0` - `255.255.255.255`。保留用于实验。

- **特殊地址**：
  - **私有地址 (Private Addresses)**：仅在局域网内部使用，不能在互联网上路由。
    - A 类：`10.0.0.0/8`
    - B 类：`172.16.0.0/12`
    - C 类：`192.168.0.0/16`
  - **回环地址 (Loopback Address)**：`127.0.0.1`（通常指 localhost），用于本机测试。
  - **广播地址 (Broadcast Address)**：主机号全为 1 的地址（如 `192.168.1.255`），用于向网络内所有主机发送数据。
  - **网络地址**：主机号全为 0 的地址（如 `192.168.1.0`），用于标识整个网络。

#### IPv4 数据包头部关键字段

IPv4 头部通常为 20 字节，包含路由和处理所需的关键信息：

- **版本 (Version)**：4，表示 IPv4。
- **生存时间 (TTL, Time To Live)**：
  - 防止数据包在网络环路中无限循环。
  - 每经过一个路由器，TTL 值减 1。当 TTL 变为 0 时，数据包被丢弃。
- **协议 (Protocol)**：
  - 指示数据包的数据部分使用的是哪个传输层协议。
  - 常见值：**6 (TCP)**, **17 (UDP)**。
- **源 IP 地址 (Source IP)**：发送方的 32 位 IP 地址。
- **目的 IP 地址 (Destination IP)**：接收方的 32 位 IP 地址。

#### 路由 (Routing)

路由器根据目的 IP 地址，查询**路由表**，决定将数据包转发给哪个下一跳 (Next Hop) 路由器，直到到达目的地。

{{< callout >}}

**IPv6** 是下一代协议，使用 128 位地址，解决了 IPv4 地址耗尽的问题。

{{</ callout >}}

## 传输层（Transport Layer）

传输层负责**端到端 (End-to-End)** 的通信，即进程与进程之间的通信。它引入了**端口号 (Port)** 的概念来区分同一台主机上运行的不同应用程序（如 Web 浏览器用 80 端口，邮件用 25 端口）。

- **单位**：段 (Segment) 或 数据报 (Datagram)。

### 传输控制协议 (TCP) 详解

TCP (Transmission Control Protocol) 是一种**面向连接的**、**可靠的**、**基于字节流**的传输层协议。

#### TCP 的核心特性

- **面向连接**：通信前必须先建立连接（打电话模式）。
- **可靠传输**：保证数据**无差错、不丢失、不重复、按序到达**。
- **流量控制**：防止发送方发得太快，接收方来不及处理。
- **拥塞控制**：防止过多的数据注入网络，导致网络瘫痪。

#### TCP 头部关键字段

- **源端口 & 目的端口**：标识通信双方的进程。
- **序列号 (Sequence Number)**：用于对字节流进行编号，解决乱序和重复问题。
- **确认号 (Acknowledgment Number)**：期望收到的下一个字节的序号，用于实现可靠传输（ACK 机制）。
- **标志位 (Flags)**：
  - **SYN**：发起新连接。
  - **ACK**：确认序号有效。
  - **FIN**：释放连接。
  - **RST**：重置连接。
- **窗口大小 (Window Size)**：用于流量控制，告诉对方自己还能接收多少数据。

#### 连接管理：三次握手与四次挥手

- **建立连接（三次握手）**：
  1. **SYN**：客户端发送 SYN 包，请求建立连接。
  2. **SYN + ACK**：服务端收到后，回复 SYN+ACK 包，表示同意。
  3. **ACK**：客户端收到后，回复 ACK 包。连接建立成功。
  - _目的：同步双方的初始序列号。_
- **断开连接（四次挥手）**：
  - 由于 TCP 是全双工的（双方都能独立发送数据），断开时需要双方分别发送 FIN 包并得到对方的 ACK 确认，总共交互 4 次。

#### 可靠性机制

- **超时重传**：发送数据后启动定时器，如果超时未收到 ACK，则重发数据。
- **滑动窗口**：允许发送方在未收到确认的情况下连续发送多个数据包，提高效率，同时配合接收方的窗口大小实现流量控制。

### 用户数据报协议 (UDP) 简述

- **特点**：无连接、不可靠、传输速度快、头部开销小（仅 8 字节）。
- **应用**：实时视频会议、在线游戏、DNS 查询（对实时性要求高，对丢包不敏感）。

## 应用层（Application Layer）

应用层直接为用户的应用程序提供网络服务。它定义了运行在不同端系统上的应用程序进程如何相互传递报文。

- **常见协议**：
  - **HTTP/HTTPS**：万维网访问（Web）。
  - **DNS**：域名系统，将域名（www.example.com）转换为 IP 地址。
  - **SMTP/POP3/IMAP**：电子邮件传输与接收。
  - **FTP**：文件传输。
  - **SSH**：安全远程登录。
- **通信模式**：
  - **C/S 模式 (Client/Server)**：客户端请求，服务器响应（如 Web）。
  - **P2P 模式 (Peer-to-Peer)**：对等连接，每个节点既是客户端也是服务器（如 BitTorrent）。
